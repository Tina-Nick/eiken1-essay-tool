<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Eiken Grade 1 Essay Practice</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 10px; border: 1px solid #ddd; }
        h1 { text-align: center; }
        textarea { width: 100%; height: 150px; margin-top: 10px; }
        button { margin: 5px; }
        .section { margin-top: 20px; }
        #timer { font-size: 1.5em; margin: 10px 0; }
        pre { background: #f0f0f0; padding: 10px; white-space: pre-wrap; }
    </style>
</head>
<body>
<h1>Eiken Grade 1 Essay Practice</h1>

<div class="section">
    <strong>Topic:</strong>
    <p id="topic">Press "Next Topic" to start!</p>
    <button onclick="nextTopic()">Next Topic</button>
    <button onclick="showModelAnswer()">Show Model Answer</button>
</div>

<div class="section">
    <strong>Timer:</strong>
    <div id="timer">0:00</div>
    <button onclick="startTimer()">Start</button>
    <button onclick="pauseTimer()">Pause</button>
    <button onclick="resetTimer()">Reset</button>
</div>

<div class="section">
    <strong>Your Essay:</strong>
    <textarea id="userEssay" placeholder="Write your essay here..." oninput="countWords()"></textarea>
    <div><strong>Word Count:</strong> <span id="wordCount">0</span> words</div>
</div>

<div class="section">
    <button onclick="showCorrection()">Check My Essay (Feedback)</button>
</div>

<div class="section">
    <strong>Model Answer:</strong>
    <pre id="modelAnswer">(Hidden)</pre>
</div>

<div class="section">
    <strong>Feedback:</strong>
    <pre id="feedback">(Feedback will appear here)</pre>
</div>

<script>
const topics = [
    { topic: "Should Japan accept more immigrants?", answer: "[Full model answer here...]" },
    { topic: "Is space exploration worth the cost?", answer: "[Full model answer here...]" },
    // You can continue populating up to 30 topics with full answers
];

let timer = 0;
let timerInterval = null;

function nextTopic() {
    const rand = Math.floor(Math.random() * topics.length);
    document.getElementById('topic').innerText = topics[rand].topic;
    document.getElementById('modelAnswer').innerText = "(Hidden)";
    document.getElementById('feedback').innerText = "(Feedback will appear here)";
    document.getElementById('userEssay').value = "";
    countWords();
}

function showModelAnswer() {
    const currentTopic = document.getElementById('topic').innerText;
    const found = topics.find(t => t.topic === currentTopic);
    if (found) document.getElementById('modelAnswer').innerText = found.answer;
}

function startTimer() {
    if (timerInterval) return;
    timerInterval = setInterval(() => {
        timer++;
        const minutes = Math.floor(timer / 60);
        const seconds = timer % 60;
        document.getElementById('timer').innerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }, 1000);
}

function pauseTimer() {
    clearInterval(timerInterval);
    timerInterval = null;
}

function resetTimer() {
    pauseTimer();
    timer = 0;
    document.getElementById('timer').innerText = "0:00";
}

function countWords() {
    const essay = document.getElementById("userEssay").value;
    const words = essay.trim().split(/\s+/).filter(w => w.length > 0);
    document.getElementById("wordCount").innerText = words.length;
}

function showCorrection() {
    const essay = document.getElementById('userEssay').value;
    if (!essay.trim()) {
        alert("Please write your essay first!");
        return;
    }

    let feedback = "";
    const wordCount = essay.trim().split(/\s+/).filter(w => w.length > 0).length;

    // Basic structure check
    const hasIntro = /I (believe|think|agree|disagree)/i.test(essay);
    const hasReasons = (essay.match(/First|Second|Third/gi) || []).length >= 3;
    const hasConclusion = /In conclusion/i.test(essay);

    feedback += `✔️ Word Count: ${wordCount}\n`;
    feedback += hasIntro ? "✔️ Introduction detected\n" : "❌ No clear introduction\n";
    feedback += hasReasons ? "✔️ At least 3 reasons detected\n" : "❌ Less than 3 clear reasons\n";
    feedback += hasConclusion ? "✔️ Conclusion detected\n" : "❌ No conclusion found\n";

    // Simple grammar pattern tips
    if (/\bthe reason is because\b/i.test(essay)) {
        feedback += "❗ Tip: Avoid 'the reason is because' → use 'the reason is that'\n";
    }
    if (/a advice/i.test(essay)) {
        feedback += "❗ Tip: 'Advice' is uncountable → say 'some advice' or 'a piece of advice'\n";
    }
    if (/many information/i.test(essay)) {
        feedback += "❗ Tip: 'Information' is uncountable → use 'much information'\n";
    }

    document.getElementById('feedback').innerText = feedback;
}
</script>

</body>
</html>
